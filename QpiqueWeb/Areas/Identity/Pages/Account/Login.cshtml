@page
@model LoginModel

@{
    ViewData["Title"] = "Iniciar sesión";
}

<div class="container min-vh-100 d-flex align-items-center justify-content-center">
    <div class="row w-100 justify-content-center">
        <div class="col-lg-5 col-md-7">
            <div class="contenido-glassLogin p-4 rounded shadow" style="max-width: 600px; width: 100%; min-height: 400px;">
                <h1 class="mb-4 text-center text-white">@ViewData["Title"]</h1>

                <form id="account" method="post" novalidate>
                    <h5 class="mb-3 text-center text-secondary fw-light">Usa una cuenta local para iniciar sesión</h5>
                    <hr />

                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                    <div class="form-floating mb-3">
                        <input asp-for="Input.Email" 
                               class="form-control" 
                               autocomplete="username" 
                               placeholder="nombre@ejemplo.com" 
                               aria-required="true" 
                               aria-describedby="emailHelp" />
                        <label asp-for="Input.Email">Correo electrónico</label>
                        <span asp-validation-for="Input.Email" class="text-danger"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input asp-for="Input.Password" 
                               type="password" 
                               class="form-control" 
                               autocomplete="current-password" 
                               placeholder="contraseña" 
                               aria-required="true" />
                        <label asp-for="Input.Password">Contraseña</label>
                        <span asp-validation-for="Input.Password" class="text-danger"></span>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" asp-for="Input.RememberMe" id="rememberMeCheck" />
                        <label class="form-check-label text-white" for="rememberMeCheck">
                            @Html.DisplayNameFor(m => m.Input.RememberMe)
                        </label>
                    </div>

                    <button id="login-submit" type="submit" class="btn btn-primary btn-lg w-100 mb-3" aria-label="Iniciar sesión">
                        <span class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                        Iniciar sesión
                    </button>

                    <div class="text-center">
                        <p>
                            <a asp-page="./ForgotPassword" class="link-secondary text-decoration-none">
                                <i class="bi bi-question-circle me-1"></i> ¿Olvidaste tu contraseña?
                            </a>
                        </p>
                        <p>
                            <a asp-page="./Register" asp-route-returnUrl="@Model.ReturnUrl" class="link-secondary text-decoration-none">
                                <i class="bi bi-person-plus me-1"></i> Registrarse como nuevo usuario
                            </a>
                        </p>
                        <p>
                            <a asp-page="./ResendEmailConfirmation" class="link-secondary text-decoration-none">
                                <i class="bi bi-envelope-arrow-up me-1"></i> Reenviar confirmación de correo
                            </a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <script>
        const form = document.getElementById('account');
        const button = document.getElementById('login-submit');
        const spinner = button.querySelector('.spinner-border');

        form.addEventListener('submit', () => {
            button.disabled = true;
            spinner.classList.remove('d-none');
        });

        // Guardar token JWT y redirigir si está disponible
        const token = "@Model.JwtToken";
        if (token) {
            sessionStorage.setItem("jwt", token);
            window.location.href = "/Productos/Index";
        }
    </script>
}
